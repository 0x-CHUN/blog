# 构造过程抽象

## 程序设计的基本元素

三种机制：

* 基本的表达形式
* 组合的方法：从简答的元素组合成复杂的元素
* 抽象的方法：为复合的对象命名，并当成单元去操作

### 命名与环境

scheme的命名：

```scheme
(define size 2)
```

命名的目的：

* 允许用一个简单的引用一个组合计算的结果，避免了重复
* 方便逐步去构造一个复杂程序

构造的值可以存入变量供以后使用，说明 Scheme 解释器有存储能力。这种存储称为“环境”；

### 组合式的求值

解释器的工作方式：

* 求值该组合式的各个子表达式
* 将最左子表达式的值作用于相应的实际参数

一般性求值规则的这种例外称为**特殊形式**；

### 复合过程

过程定义：

```scheme
(define (square x) (* x x))
; 过程名 形式参数 过程定义
; (define (<name> <formal parameters) <body>)
```

过程定义是分解和控制程序复杂性的最重要技术之一；

### 过程应用的代换模型

运算符是一个复合过程的名字；

组合式和复合过程确定的计算过程是（代换模型）：

1. 求出各参数表达式（子表达式）的值
2. 找到要调用的过程的定义
3. 用求出的实际参数代换过程体里的形式参数
4. 求值过程体

先求值参数后应用运算符：应用序求值；（scheme采用）

完全展开后归约：正则序求值；

### 条件表达式和谓词

复杂计算的描述中总需要描述条件和选择；

条件表达式：

```scheme
(cond (<p1> <e1>)
      (<p2> <e2>)
      ...
      (<pn> <en>)
      )
```

简化的条件表达式：

```scheme
(if <predicate> <consequent> <alternative>)
```

逻辑组合运算符：

```scheme
(and <e1> ... <en>)
(or <e1> ... <en>)
(not <e>)
```

求出真假值的过程称为 谓词。各种关系运算符是基本谓词，可以用 。各种关系运算符是基本谓词，可以用 and、or、not组合出各种复杂逻辑条件，可以用过程定义谓词；

### 过程定义实例：牛顿法求平方根

过程很像数学函数，但它必须了描述一种有效的计算方法

```scheme
(define (improve guess x)
  (average guess (/ x guess)))
(define (good-enough? guess x)
  (< (abs (- (square guess) x)) 0.001))
(define (sqrt-iter guess x)
  (if (good-enough? guess x)
      guess
      (sqrt-iter (improve guess x) x)))
(define (sqrt x)
  (sqrt-iter 1.0 x))
```

### 过程作为黑箱抽象

应该把被用的过程看作黑箱，只关注其功能，不关心其实现

过程抽象 的本质是一种功能分解：

* 定义过程时，关注计算的 过程式描述（怎样做），使用时只关注其说明式描述（功能，做什么）
* 一个过程总（应该）隐藏一些实现细节，使用者不需要知道它如何工作。所用过程可以是其他人开发，或由程序库提供
* 过程抽象是控制和分解程序复杂性的一种重要手段，也是记录和重用已有开发成果的单位

过程隐藏的最简单细节是局部的名字。

过程定义里使用的形参只是占位符：

*  从程序的语义看，具体采用的名字并不重要（对程序的可读性有意义），重要的是哪些地方用了同一个形参
* 形参是过程体的约束变量（概念来自数理逻辑），作用域是整个过程体，对约束变量统一换名不改变过程意义

对一个结构局部的东西应该定义在这个结构内部；

在一个过程内部 在一个过程内部 define 的东西（过程或变量）只能在该过程内使用。过程之外看不到这些名字。

## 过程与其产生的计算

一个过程（是一个文本描述）可以看作一种计算模式：

* 描述了一种特定计算的演化进程和方式
* 对一组适当的参数，确定了一个具体计算